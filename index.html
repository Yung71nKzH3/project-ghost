<!DOCTYPE html>
<html>
<head>
  <style>
    body { margin: 0; overflow: hidden; font-family: 'Consolas', 'Courier New', monospace; }

    /* UI Layer - Covers screen but lets clicks pass if empty */
    #ui-layer {
      position: absolute; top: 0; left: 0;
      width: 100vw; height: 100vh;
      display: flex; justify-content: center; align-items: center;
      pointer-events: none;
      z-index: 9999;
      transition: opacity 0.2s;
    }

    /* The Command Box */
    #command-box {
      background: rgba(0, 0, 0, 0.95);
      border: 2px solid #00ff00;
      padding: 20px;
      width: 650px;
      display: flex; flex-direction: column; gap: 15px;
      box-shadow: 0 0 25px rgba(0, 255, 0, 0.2);
      pointer-events: auto; /* Catch clicks */
      border-radius: 6px;
    }

    /* Status Text */
    #status {
      position: fixed; bottom: 15px; right: 15px;
      color: #00ff00; background: rgba(0,0,0,0.7);
      padding: 5px 10px; border-radius: 4px;
      font-weight: bold; pointer-events: none;
      z-index: 10000;
      font-size: 12px;
      text-transform: uppercase;
      border: 1px solid #00ff00;
    }

    /* Inputs & Controls */
    input[type="text"] {
      background: #0f0f0f; color: #00ff00;
      border: 1px solid #333; padding: 12px;
      font-size: 16px; font-family: inherit; outline: none;
    }
    
    .controls {
      display: flex; gap: 10px; align-items: center;
      color: #00ff00; font-size: 12px;
    }

    input[type=range] { flex-grow: 1; accent-color: #00ff00; cursor: pointer; }

    button {
      background: #002200; color: #00ff00;
      border: 1px solid #00ff00; padding: 8px 12px;
      cursor: pointer; font-weight: bold; font-family: inherit;
      transition: all 0.2s; min-width: 80px;
    }
    button:hover { background: #00ff00; color: black; }
    button.active { background: #00ff00; color: black; box-shadow: 0 0 10px #00ff00; }

    /* The Webview */
    webview { width: 100vw; height: 100vh; transition: opacity 0.2s; }

    .hidden { opacity: 0; pointer-events: none !important; }
  </style>
</head>
<body>

  <div id="ui-layer" class="hidden">
    <div id="command-box">
      <div style="text-align: center; color: #00ff00; letter-spacing: 3px; font-size: 14px;">
        GHOST://SYSTEM_OVERLAY
      </div>
      
      <input type="text" id="urlInput" placeholder="ENTER TARGET URL..." />
      
      <div class="controls">
        <span>OPACITY</span>
        <input type="range" id="opacitySlider" min="0.1" max="1" step="0.05" value="1">
        
        <button onclick="navigate()">GO</button>
        <button id="glassBtn" onclick="toggleGlassMode()">GLASS FX</button>
        <button onclick="toggleCinemaMode()">CINEMA</button>
      </div>
      <div style="font-size: 10px; color: #666; text-align: center;">
        [Ctrl+Shift+Z: Stealth] [Ctrl+Shift+X: Command]
      </div>
    </div>
  </div>

  <div id="status">STATUS: GHOST</div>

  <webview id="view" src="about:blank"></webview>

  <script>
    const { ipcRenderer } = require('electron');
    
    const uiLayer = document.getElementById('ui-layer');
    const status = document.getElementById('status');
    const view = document.getElementById('view');
    const input = document.getElementById('urlInput');
    const glassBtn = document.getElementById('glassBtn');

    // STATE
    let currentMode = 'GHOST'; // GHOST, STEALTH, COMMAND
    let glassKey = null;       // To store the injected CSS key

    // --- 1. MODE SWITCHING LOGIC ---

    function setMode(mode) {
      currentMode = mode;
      
      if (mode === 'GHOST') {
        // Game Mode: No UI, No Clicks
        uiLayer.classList.add('hidden');
        status.innerText = "STATUS: GHOST (GAME ACTIVE)";
        status.style.opacity = '0.5';
        ipcRenderer.send('set-ignore-mouse', true);
      
      } else if (mode === 'STEALTH') {
        // Stealth Mode: Clicks work, UI hidden (Good for pausing video)
        uiLayer.classList.add('hidden');
        status.innerText = "STATUS: STEALTH (MOUSE ACTIVE)";
        status.style.opacity = '1';
        ipcRenderer.send('set-ignore-mouse', false);
      
      } else if (mode === 'COMMAND') {
        // Command Mode: Full UI, Clicks work
        uiLayer.classList.remove('hidden');
        status.innerText = "STATUS: COMMAND CENTER";
        status.style.opacity = '1';
        ipcRenderer.send('set-ignore-mouse', false);
        input.focus();
        input.select();
      }
    }

    // Listen for Shortcuts from Main Process
    ipcRenderer.on('toggle-stealth', () => {
      // Toggle between GHOST and STEALTH
      setMode(currentMode === 'GHOST' ? 'STEALTH' : 'GHOST');
    });

    ipcRenderer.on('toggle-command', () => {
      // Toggle between GHOST and COMMAND
      setMode(currentMode === 'GHOST' ? 'COMMAND' : 'GHOST');
    });


    // --- 2. GLASS FX TOGGLE ---

    async function toggleGlassMode() {
      if (glassKey) {
        // If key exists, remove CSS (Turn Off)
        await view.removeInsertedCSS(glassKey);
        glassKey = null;
        glassBtn.classList.remove('active');
      } else {
        // Inject CSS (Turn On)
        // We target broad elements to force transparency
        const css = `
          html, body { background: transparent !important; }
          #content, #page-manager, #columns, #primary, #secondary { background: transparent !important; }
          ytd-app { background: transparent !important; }
          .ytp-gradient-top, .ytp-gradient-bottom { display: none !important; } /* Hide YT shadows */
        `;
        glassKey = await view.insertCSS(css);
        glassBtn.classList.add('active');
      }
    }


    // --- 3. CINEMA MODE (Fake Fullscreen) ---

    function toggleCinemaMode() {
      // This script runs INSIDE the webview to find the video and blow it up
      const code = `
        (function() {
          const video = document.querySelector('video');
          if (!video) return;
          
          // Check if we already applied our custom class
          if (video.classList.contains('ghost-cinema')) {
            // Revert
            video.style.cssText = '';
            video.classList.remove('ghost-cinema');
          } else {
            // Apply Cinema Mode
            // We force it to fixed position, top left, 100% width/height
            // and highest Z-index possible.
            video.style.cssText = 'position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; z-index: 2147483647 !important; background: black;';
            video.classList.add('ghost-cinema');
          }
        })();
      `;
      view.executeJavaScript(code);
    }


    // --- 4. STANDARD UTILS ---

    function navigate() {
      let url = input.value;
      if (!url) return;
      if (!url.startsWith('http')) url = 'https://' + url;
      view.src = url;
      setMode('GHOST'); // Auto hide after go
    }

    document.getElementById('opacitySlider').addEventListener('input', (e) => {
      view.style.opacity = e.target.value;
    });

    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') navigate();
    });

    // Start in Ghost Mode
    setMode('GHOST');

  </script>
</body>
</html>