<!DOCTYPE html>
<html>
<head>
  <style>
    body { margin: 0; overflow: hidden; font-family: 'Consolas', 'Courier New', monospace; }

    /* UI Layer */
    #ui-layer {
      position: absolute; top: 0; left: 0;
      width: 100vw; height: 100vh;
      display: flex; justify-content: center; align-items: center;
      z-index: 9999;
      transition: opacity 0.2s, visibility 0.2s; /* Animate visibility too */
    }

    /* The Command Box */
    #command-box {
      background: rgba(0, 0, 0, 0.95);
      border: 2px solid #00ff00;
      padding: 20px;
      width: 650px;
      display: flex; flex-direction: column; gap: 15px;
      box-shadow: 0 0 25px rgba(0, 255, 0, 0.2);
      pointer-events: auto;
      border-radius: 6px;
    }

    /* Status Text */
    #status {
      position: fixed; bottom: 15px; right: 15px;
      color: #00ff00; background: rgba(0,0,0,0.7);
      padding: 5px 10px; border-radius: 4px;
      font-weight: bold; pointer-events: none;
      z-index: 10000;
      font-size: 12px;
      text-transform: uppercase;
      border: 1px solid #00ff00;
      transition: opacity 0.2s;
    }

    /* Inputs & Controls */
    input[type="text"] {
      background: #0f0f0f; color: #00ff00;
      border: 1px solid #333; padding: 12px;
      font-size: 16px; font-family: inherit; outline: none;
    }
    
    .controls {
      display: flex; gap: 10px; align-items: center;
      color: #00ff00; font-size: 12px;
    }

    input[type=range] { flex-grow: 1; accent-color: #00ff00; cursor: pointer; }

    button {
      background: #002200; color: #00ff00;
      border: 1px solid #00ff00; padding: 8px 12px;
      cursor: pointer; font-weight: bold; font-family: inherit;
      transition: all 0.2s; min-width: 80px;
    }
    button:hover { background: #00ff00; color: black; }
    button.active { background: #00ff00; color: black; box-shadow: 0 0 10px #00ff00; }

    /* The Webview */
    webview { width: 100vw; height: 100vh; transition: opacity 0.3s; }

    /* Utility to hide things completely */
    .hidden { 
      opacity: 0; 
      visibility: hidden; /* Takes it out of render tree - NO INTERACTION */
      pointer-events: none !important; 
    }
    
    .fully-hidden {
      opacity: 0 !important;
      pointer-events: none !important;
    }
  </style>
</head>
<body>

  <div id="ui-layer" class="hidden">
    <div id="command-box">
      <div style="text-align: center; color: #00ff00; letter-spacing: 3px; font-size: 14px;">
        GHOST://SYSTEM_OVERLAY
      </div>
      
      <input type="text" id="urlInput" placeholder="ENTER TARGET URL..." />
      
      <div class="controls">
        <span>OPACITY</span>
        <input type="range" id="opacitySlider" min="0.1" max="1" step="0.05" value="1">
        
        <button onclick="navigate()">GO</button>
        <button id="glassBtn" onclick="toggleGlassMode()">GLASS FX</button>
        <button onclick="toggleCinemaMode()">CINEMA</button>
      </div>
      <div style="font-size: 10px; color: #666; text-align: center;">
        [Shift+Z: Stealth] [Shift+X: Menu] [Shift+H: Hide All]
      </div>
    </div>
  </div>

  <div id="status">STATUS: GHOST</div>

  <webview id="view" src="about:blank"></webview>

  <script>
    const { ipcRenderer } = require('electron');
    
    const uiLayer = document.getElementById('ui-layer');
    const status = document.getElementById('status');
    const view = document.getElementById('view');
    const input = document.getElementById('urlInput');
    const glassBtn = document.getElementById('glassBtn');

    let currentMode = 'GHOST';
    let glassKey = null;

    // --- 1. MODE SWITCHING LOGIC ---

    function setMode(mode) {
      currentMode = mode;
      
      if (mode === 'GHOST') {
        // Game Mode: No UI, No Clicks, NO HOVER
        uiLayer.classList.add('hidden');
        view.classList.remove('fully-hidden');
        status.innerText = "STATUS: GHOST (GAME ACTIVE)";
        status.style.opacity = '0.5';
        
        // forward: false is the magic fix for "Hover" issues
        ipcRenderer.send('set-ignore-mouse', { ignore: true, forward: false });
      
      } else if (mode === 'STEALTH') {
        // Stealth Mode: Clicks work, UI hidden
        uiLayer.classList.add('hidden');
        view.classList.remove('fully-hidden');
        status.innerText = "STATUS: STEALTH (MOUSE ACTIVE)";
        status.style.opacity = '1';
        
        ipcRenderer.send('set-ignore-mouse', { ignore: false });
      
      } else if (mode === 'COMMAND') {
        // Command Mode: Full UI, Clicks work
        uiLayer.classList.remove('hidden');
        view.classList.remove('fully-hidden');
        status.innerText = "STATUS: COMMAND CENTER";
        status.style.opacity = '1';
        
        ipcRenderer.send('set-ignore-mouse', { ignore: false });
        input.focus();
        input.select();
      
      } else if (mode === 'HIDDEN') {
        // Panic Mode: Hide everything
        uiLayer.classList.add('hidden');
        view.classList.add('fully-hidden'); // CSS opacity 0
        status.style.opacity = '0'; // Hide status too
        
        // Keep in ghost mode (ignore mouse)
        ipcRenderer.send('set-ignore-mouse', { ignore: true, forward: false });
      }
    }

    // Listen for Shortcuts
    ipcRenderer.on('toggle-stealth', () => {
      setMode(currentMode === 'GHOST' ? 'STEALTH' : 'GHOST');
    });

    ipcRenderer.on('toggle-command', () => {
      setMode(currentMode === 'GHOST' ? 'COMMAND' : 'GHOST');
    });

    ipcRenderer.on('toggle-hide', () => {
      // Toggle between HIDDEN and GHOST
      if (currentMode === 'HIDDEN') {
        setMode('GHOST');
      } else {
        setMode('HIDDEN');
      }
    });


    // --- 2. GLASS FX & CINEMA (Same as before) ---

    async function toggleGlassMode() {
      if (glassKey) {
        await view.removeInsertedCSS(glassKey);
        glassKey = null;
        glassBtn.classList.remove('active');
      } else {
        const css = `
          html, body { background: transparent !important; }
          #content, #page-manager, #columns, #primary, #secondary { background: transparent !important; }
          ytd-app { background: transparent !important; }
          .ytp-gradient-top, .ytp-gradient-bottom { display: none !important; }
        `;
        glassKey = await view.insertCSS(css);
        glassBtn.classList.add('active');
      }
    }

    function toggleCinemaMode() {
      const code = `
        (function() {
          const video = document.querySelector('video');
          if (!video) return;
          if (video.classList.contains('ghost-cinema')) {
            video.style.cssText = '';
            video.classList.remove('ghost-cinema');
          } else {
            video.style.cssText = 'position: fixed !important; top: 0 !important; left: 0 !important; width: 100vw !important; height: 100vh !important; z-index: 2147483647 !important; background: black;';
            video.classList.add('ghost-cinema');
          }
        })();
      `;
      view.executeJavaScript(code);
    }

    // --- UTILS ---
    function navigate() {
      let url = input.value;
      if (!url) return;
      if (!url.startsWith('http')) url = 'https://' + url;
      view.src = url;
      setMode('GHOST');
    }

    document.getElementById('opacitySlider').addEventListener('input', (e) => {
      view.style.opacity = e.target.value;
    });

    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') navigate();
    });

    // Start
    setMode('GHOST');

  </script>
</body>
</html>